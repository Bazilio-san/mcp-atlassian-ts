# Сравнение реализаций MCP сервера: старая (mcp-atlasian-js) vs новая (src)

Цель: понять различия между старой реализацией в папке `mcp-atlasian-js` и новой реализацией в папке `src`, и ответить на вопрос — есть ли у старой версии какие-либо преимущества.

## Обзор
- Старая реализация: `mcp-atlasian-js`
  - Простая структура: `index.ts` + набор тонких обёрток-инструментов в `src/tools`, сервисы в `src/services`.
  - Транспорт: HTTP + Streamable HTTP (SSE) через Express.
  - Инструменты: базовые операции для JIRA и Confluence (поиск, чтение/простые записи).
  - Библиотеки: использует `node-fetch`/HTTPS агент для Confluence и готовый `ts-jira-client` для Jira.
  - Фильтрация инструментов: утилита `utils/tool-filter.ts` (списки READ/WRITE, `READ_ONLY_MODE`, `ENABLED_TOOLS`).
  - Конфигурация: централизована в `config/env.ts`, много опций (.env), в т.ч. OAuth поля.
  - Особенность: жёсткое отключение проверки TLS в `index.ts` (`NODE_TLS_REJECT_UNAUTHORIZED='0'`).

- Новая реализация: `src`
  - Архитектура: доменно-ориентированная (`src/domains/{jira,confluence}`), общий каркас (`src/core/{server,auth,config,errors,cache,utils}`), строгий TypeScript.
  - Транспорт: README декларирует поддержку STDIO, HTTP и SSE (транспорт-агностичность).
  - Инструменты: существенно шире покрытие, детальная типизация, централизованная обработка ошибок.
  - Фильтрация инструментов: через `src/core/config/getEnabledTools()` и категории инструментов в сервере.
  - Безопасность и ошибки: централизованные ошибки (`core/errors`), логгер, валидация, best practices.
  - Тесты: Jest, кастомные матчеры, более полное покрытие.

## Инструменты (неполный перечень для ориентирования)
- Старая (`mcp-atlasian-js/src/tools`):
  - Confluence: `search_confluence`, `search_confluence_pages_by_title`, `get_confluence_space_by_id_or_key`, `get_confluence_spaces`, `get_confluence_content`, `get_confluence_pages`, `get_confluence_pages_by_label`, `get_confluence_page_inline_comments`, `confluence_create_page`, `confluence_update_page`, `update_confluence_page_title`, `create_confluence_footer_comment`.
  - JIRA: `search_jira_issues`, `get_jira_issue`, `jira_create_issue`, `jira_update_issue`, `jira_add_comment`, `jira_transition_issue`, `jira_get_transitions`, `jira_get_all_projects`.
- Новая (`src/domains/{jira,confluence}/tools.ts`):
  - Значительно больше инструментов и параметров (расширенные CRUD/Agile/Worklog, фильтрация, история, пространства и т.п.).

## Ключевые различия
- Покрытие функционала:
  - Старая: достаточный минимум для распространённых сценариев.
  - Новая: широкое покрытие API JIRA/Confluence, включая сложные кейсы (Agile, батчи, история, расширенный поиск/поля и пр.).
- Архитектура и поддерживаемость:
  - Старая: простой, «плоский» код; легко читать и быстро модифицировать точечные обёртки.
  - Новая: модульная, типобезопасная, с едиными слоями логирования/ошибок/конфигурации; легче масштабировать и поддерживать долгосрочно.
- Транспорт и интеграция:
  - Старая: HTTP + Streamable HTTP (SSE) из коробки (Express). Удобно для быстрой интеграции через веб.
  - Новая: заявлена транспорт-агностичность (STDIO/HTTP/SSE), что шире по совместимости.
- Обработка ошибок и валидация:
  - Старая: локальная обработка через `formatResponse/formatErrorResponse`, без единого централизованного слоя.
  - Новая: централизованная обработка (`withErrorHandling`, собственные ошибки), лучшая диагностируемость и предсказуемость.
- Конфигурация и управление инструментами:
  - Старая: `READ_ONLY_MODE`, явные списки READ/WRITE, `ENABLED_TOOLS` — очень наглядно и просто.
  - Новая: аналогичная возможность через `core/config`, но включена в общий каркас и более гибкая.
- Безопасность (TLS):
  - Старая: в `index.ts` безусловно выставляет `NODE_TLS_REJECT_UNAUTHORIZED='0'` — удобно для разработки с самоподписанными сертификатами, но небезопасно для прод.
  - Новая: ориентирована на корректную валидацию TLS и настройки через конфигурацию.
- Зависимости:
  - Старая: опирается на `ts-jira-client` (внешний клиент), минимум «внутренней магии».
  - Новая: собственные клиенты/утилиты внутри кода — больше контроля, но выше сложность.
- Тестирование:
  - Старая: минимальное/локальное.
  - Новая: Jest и инфраструктура тестов в репозитории.

## Есть ли преимущества у старой реализации?
Да, хотя в целом новая реализация значительно мощнее и лучше подходит для продакшена, у старой версии есть практические преимущества — в первую очередь для быстрых прототипов и локальной разработки:
- Простота и низкий порог входа: меньше слоёв и абстракций, легче разобраться и быстро добавить/поменять инструмент.
- Быстрый запуск HTTP/SSE сервера (Express) без сложной конфигурации.
- Очень наглядное управление доступностью инструментов и режимом только для чтения через `.env` (READ_ONLY_MODE, ENABLED_TOOLS).
- «Лояльность» к средам с самоподписанными сертификатами: отключение TLS‑проверки по умолчанию упрощает работу в корпоративных сетях и on‑prem инсталляциях (хотя это риск для боевых сред).
- Использование готового клиента `ts-jira-client` может ускорить интеграцию с JIRA без необходимости поддерживать собственный HTTP-слой.

Однако для продакшена предпочтительнее новая реализация, т.к. она предоставляет:
- Более широкое покрытие API и возможностей.
- Централизованную обработку ошибок и продуманный логгинг.
- Лучшую типобезопасность и расширяемость архитектуры.
- Тестовую инфраструктуру и транспортную гибкость (STDIO/HTTP/SSE).
- Более безопасные практики работы с TLS и конфигурацией.

## Вывод
- Старую реализацию имеет смысл использовать для быстрых PoC/внутренних интеграций, где ценится скорость и простота.
- Новая реализация — выбор по умолчанию для долгосрочных и безопасных внедрений с богатыми требованиями к функционалу.
